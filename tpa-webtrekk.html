<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="tpa-webtrekk-loader.html">
<link rel="import" href="../iron-signals/iron-signals.html">

<!--

`tpa-webtrekk` is for connecting your applications web analytics iron-signal events to WebTrekk

    <tpa-webtrekk></tpa-webtrekk>

Example:

    <tpa-webtrekk></tpa-webtrekk>

@element tpa-webtrekk
@demo demo/index.html
-->
<dom-module id="tpa-webtrekk">
    <template>

        <iron-signals on-iron-signal-businessmonitoring-send-page-visit="onPageVisit"></iron-signals>
        <iron-signals on-iron-signal-businessmonitoring-send-action="onAction"></iron-signals>
        <iron-signals on-iron-signal-businessmonitoring-send-error-message="onErrorMessage"></iron-signals>
        <iron-signals on-iron-signal-businessmonitoring-send-form-step="onFormStep"></iron-signals>
        <iron-signals on-iron-signal-businessmonitoring-send-search-action="onSearchAction"></iron-signals>

    </template>
</dom-module>
<script>

    (function() {

        webtrekkConfig = {
            trackId: "105490315397978", //this might be different per app/country/...
            trackDomain: "mon.ingservices.nl", //this might be different per app/country/...
            domain: "www.tpabootstrap.net", //this might be different per app/country/...
            cookie: "1",
            tabBrowsing: true,
            execCDB: false,
            execRTA: false
        };

        /**
         * The initialized WebTrekk class for communicating events
         */
        var wt = new webtrekkV3({
            linkTrack: "link",
            linkTrackAttribute: "id",
            linkTrackDownloads: "zip;pdf;doc"
        });

        Polymer({

            is: "tpa-webtrekk",

            onPageVisit: function (data) {
                wt.contentId = "tpa:" + data.detail.category + ":" + data.detail.pagename;
                wt.sendinfo();
            },

            onAction: function (data) {
                wt.sendinfo({linkId: data.detail.action});
            },

            onSearchAction: function (data) {
                wt.sendinfo({internalSearch: data.detail.searchTerm});
            },

            //The configuration of the parameters in this function is specific for NL...
            onErrorMessage: function (data) {
                wt.sendinfo ({
                    customParameter : {
                        14 : data.detail.error,
                        15 : data.detail.errorType
                    }
                });
            },

            //The configuration of the parameters in this function is specific for NL...
            onFormStep: function (data) {
                wt.contentId = "tpa:" + data.detail.formId + ":" + data.detail.formId + ":" + data.detail.formStep
                wt.product = data.detail.formId
                wt.productQuantity = wt.orderValue = 1
                wt.productStatus = data.detail.formStatus //Possible values should only be 'view' for starting the form and 'conf' for succesfully finishing the form
                wt.orderId = data.detail.transactionId //This should either be a generated random, unique value (epoch timestamp + random value) or an actual transactional ID
                wt.sendinfo ({
                    customEcommerceParameter : {
                        6 : data.detail.formOutcome //In case a form has a specific outcome (a customer can either signup for A or B within the same form)
                    }
                });
            }




        })
    })();
</script>